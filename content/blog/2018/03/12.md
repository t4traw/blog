---
title: AWS(Amazon) Cloud9ç’°å¢ƒã§Headless Chromeã‚’ä½¿ã†
date: 2018-03-12
categories:
  - aws
tags:
  - aws
  - cloud9
  - rails
  - chrome
  - miniteset
image:
---
AWS(Amazon) Cloud9ç’°å¢ƒã«Headless Chromeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

<!--more-->

Amazon Linuxã§ã¯Chromeã‚’å…¥ã‚Œã‚‹ã®ãŒã‚ã¡ã‚ƒãã¡ã‚ƒå¤§å¤‰ã§è‹¦åŠ´ã—ã¾ã—ãŸorz ä¾¿åˆ©ãª.shã‚’æä¾›ã—ã¦ãã‚Œã¦ã„ã‚‹æ‰€ãŒã‚ã£ãŸã®ã§ã€ãã“ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

å‚è€ƒ: [INSTALLING GOOGLE CHROME ON CENTOS, AMAZON LINUX, OR RHEL](https://intoli.com/blog/installing-google-chrome-on-centos/)

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚µã‚¯ã£ã¨Chromeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹äº‹ãŒã§ãã¾ã™ã€

```
$ curl https://intoli.com/install-google-chrome.sh | bash
```

â€»ã¡ãªã¿ã«ã€ã“ã†ã„ã†.shãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ˆãç„¡ããªã£ã¦ã„ãŸã‚Šã™ã‚‹ã®ã§ã€gistãªã©ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã®ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚

ç„¡äº‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã€æ¬¡ã¯ãƒ•ã‚©ãƒ³ãƒˆãƒ‘ãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚

```
$ sudo yum -y install ipa-gothic-fonts
```

ãã—ã¦ã€Gemfileã«chrome-driverã‚’è¿½åŠ ã—ã¾ã™ã€‚

###### Gemfile
```ruby
gem 'chrome-driver'
```

æœ€å¾Œã«ã€Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã®test/application_system_test_case.rbã®ä¸­èº«ã‚’ã“ã‚“ãªæ„Ÿã˜ã«å¤‰æ›´ã—ã¾ã™ã€‚

###### test/application_system_test_case.rb
```ruby
require "test_helper"

class ApplicationSystemTestCase < ActionDispatch::SystemTestCase
  caps = Selenium::WebDriver::Remote::Capabilities.chrome("chromeOptions" => {"args" => %w(--headless)})
  driven_by :selenium, using: :chrome, screen_size: [1400, 1400], options: { desired_capabilities: caps }
end
```

è©¦ã—ã«é©å½“ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦testã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
$ rails test test/*
Run options: --seed 33191

# Running:

Puma starting in single mode...
* Version 3.11.3 (ruby 2.4.1-p111), codename: Love Song
* Min threads: 0, max threads: 1
* Environment: test
* Listening on tcp://0.0.0.0:35187
Use Ctrl-C to stop
.

Finished in 3.159344s, 0.3165 runs/s, 0.3165 assertions/s.
1 runs, 1 assertions, 0 failures, 0 errors, 0 skips
```

ç„¡äº‹ã„ã‘ãŸã‚ˆã†ã§ã™ã€‚

PhantomJSã®é–‹ç™ºãŒçµ‚äº†ã—ã€ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆã¨ã„ã£ãŸã‚‰Chromeã«ãªã‚‹ã¨æ€ã†ã®ã§ã€ã‚‚ã¡ã£ã¨æ¥½ã«ç’°å¢ƒãŒä½œã‚Œã‚‹ã¨æ¥½ãªã‚“ã ã‘ã©ãªãã€‚

ãã‚Œã§ã¯ğŸ‘
