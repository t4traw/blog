---
title: middleman(4.2.1) + webpack(3.10.0)ã§ãƒ¢ãƒ€ãƒ³ãªé™çš„ã‚µã‚¤ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œã‚‹
date: 2018-02-06
categories:
  - middleman
tags:
  - middleman
  - webpack
image: 
---
ä»¥å‰ã€[middleman+gulpã§é™çš„ã‚µã‚¤ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçš„ãªç‰©ã‚’ä½œã£ã¦ã¿ã‚‹]({% post_url 2016/03/2016-03-31-tech %})ã¨ã„ã†è¨˜äº‹ã‚’æ›¸ã„ãŸäº‹ãŒã‚ã‚Šã¾ã™ãŒã€ã‚ã‚Œã‹ã‚‰ã‚‚ã†2âˆ’3å¹´ã€‚æœ€è¿‘webpackã‚’å‹‰å¼·ã—ã¦ã„ã‚‹äº‹ã‚‚ã‚ã‚Šã€ã‚‚ã†gulpã‚’ä½¿ã‚ãªããªã‚Šã¾ã—ãŸã€‚

<!--more-->

middleman + gulpã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚¡ã‚¤ãƒ«å‹•ä½œãŒãªã‹ãªã‹è¤‡é›‘ã ã£ãŸã—ã€webpackã‚’ä½¿ã£ãŸæ–¹ãŒè¨­å®šãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã®ã§ã€middleman + webpackãªæœ€æ–°ã®é™çš„ã‚µã‚¤ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

ã¡ãªã¿ã«ä»Šå›ä½œã£ãŸã‚‚ã®ã¯ã“ã¡ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã«pushã—ã¦ãŠãã¾ã—ãŸã€‚

[t4traw/middleman-webpack-sample](https://github.com/t4traw/middleman-webpack-sample)

## ğŸ“ ä»Šå›ä½¿ã£ãŸã‚‚ã®(ver)

- ruby(2.5.0)
- middleman(4.2.1)
- webpack(3.10.0)
  - autoprefixer(7.2.5)
  - css-loader(0.28.9)
  - csswring(6.0.2)
  - node-sass(4.7.2)
  - postcss-loader(2.1.0)
  - sass-loader(6.0.6)
  - style-loader(0.20.1)

## ğŸŒ± äº‹å‰æº–å‚™

ä»Šå›ã¯webpackã‚’ä½¿ã†ã®ã§ã€nodejsãŒå¿…è¦ã§ã™ã€‚ã¾ãŸåƒ•ã¯yarnã‚’ä½¿ç”¨ã—ãŸã®ã§ã€yarnã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ã€‚Macç’°å¢ƒã®æ–¹ã¯brewã‹ã‚‰ã‚µã‚¯ã£ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```
$ brew intall node
$ brew intall yarn
```

## ğŸ”§ ã¾ãšã¯middlemanã¨webpackã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯Gemfileã‚’ã‚µã‚¯ã£ã¨æº–å‚™ã€‚

```
$ mkdir YOUR_SITE_NAME && cd $_
$ bundle init
```

Gemfileã®ä¸­ã«middlemanã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚

###### Gemfile
```ruby
gem "middleman"
```

ãã—ã¦bundle installã—ã¾ã™ã€‚

```
$ bundle install
```

middlemanãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã€middleman newã—ã¾ã™ã€‚

```
$ middleman new .
```

ã“ã®æ®µéšã§.gitignoreãŒç”Ÿæˆã•ã‚Œã¾ã™ãŒã€node_modulesãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¥ã£ã¦ã„ãªã„ã®ã§ã€ã‚µã‚¯ã£ã¨.gitignoreã‚’ç”Ÿæˆã—ãªãŠã—ã¾ã™ã€‚

```
$ rm -f .gitignore && curl https://www.gitignore.io/api/node%2Csass%2Cruby%2Cmacos%2Cgrunt > .gitignore
```

webpackã‚’ä½¿ã†ãŸã‚ã«package.jsonã‚’ç”¨æ„ã—ã¾ã™ã€‚yarn initã™ã‚‹æ™‚ã«ã„ãã¤ã‹è³ªå•ãŒã‚ã‚Šã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšå…¨éƒ¨Enterã§å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚å¿…è¦ãŒã‚ã‚Œã°å¤‰ãˆã¦ãã ã•ã„ã€‚

```
$ yarn init
```

package.jsonãŒã§ããŸäº‹ã‚’ç¢ºèªã—ãŸã‚‰ã€å¿…è¦ãªnpmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚ã¾ãšã¯æœ¬å‘½webpackã¡ã‚ƒã‚“ã€‚ãã—ã¦å¿…ãšå¿…è¦ã«ãªã‚‹webpack.config.jsã‚’ç”Ÿæˆã—ã¦ãŠãã¾ã™ã€‚

```
$ yarn add webpack --dev
$ touch webpack.config.js
```

ã“ã®æ®µéšã§ã¾ãšã¯middlemanã®external_pipeline(å¤–éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)ã§webpackãŒå‹•ãã‹ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

###### config.rb
```ruby
activate :relative_assets
set :relative_links, true

activate :external_pipeline, {
  name: :webpack,
  command: build? ?
    "NODE_ENV=production yarn run build" :
    "NODE_ENV=develop yarn run develop",
  source: ".tmp/dist",
  latency: 1
}
```

###### package.json
```json
{
  "name": "middleman-webpack-sample",
  "version": "1.0.0",
  "main": "index.js",
  "repository": "ssh://git@github.com/t4traw/middleman-webpack-sample.git",
  "author": "Tatsuro Moriyama <t4traw@gmail.com>",
  "license": "MIT",
  "devDependencies": {
    "webpack": "^3.10.0"
  },
  "scripts": {
    "develop": "webpack --config ./webpack.config.js --watch -d --progress --colors",
    "build": "webpack --config ./webpack.config.js --bail -p"
  }
}
```

###### webpack.config.json
```javascript
const webpack = require('webpack');
module.exports = {
  entry: [
    './source/javascripts/site.js'
  ],
  output: {
    path: __dirname + '/.tmp/dist',
    filename: 'javascripts/bundle.js'
  }
};
```

å„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šè¨˜ã®ã‚ˆã†ã«ã—ã€ã¨ã‚Šã‚ãˆãšmiddlemanã‚’èµ·å‹•ã—ã¦ã¿ã¾ã™ã€‚

```
$ middleman
```

â†“ã¿ãŸã„ãªæ„Ÿã˜ã§è¡¨ç¤ºã•ã‚Œã‚Œã°ã²ã¨ã¾ãšæˆåŠŸã§ã™ã€‚

```
== The Middleman is loading
== Executing: `NODE_ENV=develop yarn run develop`
== View your site at "//localhost:4567", "//127.0.0.1:4567"
== Inspect your site configuration at "//localhost:4567/__middleman", "//127.0.0.1:4567/__middleman"
== External: yarn run v1.3.2
== External: $ webpack --config ./webpack.config.js --watch -d --progress --colors
 10% building modules 1/1 modules 0 active== External: Webpack is watching the filesâ€¦
== External: Hash: 56b513b6e7776f8a5874
== External: Version: webpack 3.10.0
== External: Time: 106ms
== External:                 Asset     Size  Chunks             Chunk Names
== External: javascripts/bundle.js  3.57 kB       0  [emitted]  main
== External:    [0] multi ./source/javascripts/site.js 28 bytes {0} [built]
== External:    [1] ./source/javascripts/site.js 32 bytes {0} [built]
```

![](https://s3-ap-northeast-1.amazonaws.com/t4traw/blog/2018-02-06_13-43-48.png)

èµ·å‹•ã®ç¢ºèªãŒã§ããŸã®ã§ã€ã‚ã¨ã¯javascriptã®èª­ã¿è¾¼ã¿ã‚’layoutã«æ›¸ãã¾ã™ã€‚

###### source/layouts/layout.erb
```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title><%= current_page.data.title || "Middleman" %></title>
    <%= stylesheet_link_tag "site" %>
    <%= javascript_include_tag "site" %>
  </head>
  <body>
    <%= yield %>
  </body>
  <%= javascript_include_tag :bundle %>
</html>
```

ã“ã“ã¾ã§ä¸‹æº–å‚™ã€‚webpack.config.jsonã®outputã«æ›¸ãã¾ã—ãŸãŒã€`filename: 'javascripts/bundle.js'`ã¨ã—ã¦ã„ã‚‹ã®ã§ã€bundle.jsã‚’èª­ã¿è¾¼ã‚ã°å…¨ã¦ã®css(sass)ã¨javascriptãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚

## ğŸš˜ webpackã§cssã‚’ã„ã„æ„Ÿã˜ã«ã™ã‚‹

### javascriptã§cssã‚’èª­ã¿è¾¼ã‚“ã§æç”»

ã¾ãšã€javascriptã§cssã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã™ã€‚èª­ã¿è¾¼ã‚“ã§ã€`<head>`ã®ä¸€ç•ªä¸‹ã«æ›¸ãè¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã™ã€‚æœ€åˆã¯ã“ã®æ–¹æ³•ã©ã†ãªã®ã‹ãªãï¼Ÿã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€httpãƒªã‚¯ã‚¨ã‚¹ãƒˆå°‘ãªã„æ–¹ãŒè‰¯ã„ã—ã€æœ€è¿‘ã ã¨htmlã¨ã‹ã‚‚èª­ã¿è¾¼ã‚“ã ã‚Šã™ã‚‹ä¸–ç•Œã«ãªã£ã¦ããŸã®ã§ã€ã‚‚ã†cssã¯jsã§æ›¸ãè¾¼ã‚€äº‹ã«ã—ã¾ã—ãŸã€‚

ã¨ã„ã†ã‚ã‘ã§ã€ã¾ãšã¯yarnã§å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
$ yarn add style-loader css-loader --dev
```

webpack.config.jsonã«sassã‚‚ã—ãã¯scssã‚’style-loader css-loaderã‚’ä½¿ã†ã‚ˆã†ã«è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

###### webpack.config.json
```javascript
const webpack = require('webpack');
module.exports = {
  entry: [
    './source/javascripts/site.js'
  ],
  output: {
    path: __dirname + '/.tmp/dist',
    filename: 'javascripts/bundle.js'
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          "style-loader",
          "css-loader",
        ]
      },
    ]
  }
};
```

æ¬¡ã«site.jsã§cssã‚’èª­ã¿è¾¼ã‚“ã§ã¿ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨site.css.scssã«ãªã£ã¦ã‚‹ã‚“ã§ã€ä¸€æ™‚çš„ã«.scssã‚’æ¶ˆã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

###### source/javascripts/site.js
```javascript
import '../stylesheets/site.css';
```

å®Ÿéš›ã«èª­ã¿è¾¼ã‚ã¦ã‚‹ã‹åˆ†ã‹ã‚‹ã‚ˆã†ã«é©å½“ã«èƒŒæ™¯è‰²ãªã©ã‚’å¤‰ãˆã¦ã€DOMã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ¼ã§è¦‹ã¦ã¿ã¾ã™ã€‚

![](https://s3-ap-northeast-1.amazonaws.com/t4traw/blog/2018-02-06_13-52-06.png)

ã„ã„æ„Ÿã˜ã§ã™ã€‚

### sassã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

cssã®èª­ã¿è¾¼ã¿ã¯ç„¡äº‹ã§ããŸã®ã§ã€sassã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚æœ€è¿‘ã¯sassã‚‚å¤ã„ã¨ã„ã†é¢¨æ½®ãŒã‚ã‚Šã¾ã™ãŒã€åƒ•ã®ä¸­ã§ã¯ãƒãƒªãƒãƒªç¾å½¹ãªã®ã§sassã‚’ä½¿ã„ã¾ã™ğŸ˜„

```
$ yarn add node-sass sass-loader --dev
```

webpack.config.jsonã«è¿½åŠ ã—ã¾ã™ã€‚ãã—ã¦ã€å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã‚’cssã‹ã‚‰sassã«å¤‰æ›´ã—ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚‚site.css.scssã«æˆ»ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚

###### webpack.config.json
```javascript
ã€œã€œã€œçœç•¥ã€œã€œã€œ
  module: {
    rules: [
      {
        test: /\.(sass|scss)$/,
        use: [
          "style-loader",
          "css-loader",
          "sass-loader"
        ]
      },
    ]
  }
```

###### source/javascripts/site.js
```javascript
import '../stylesheets/site.css.scss';
```

ã“ã‚Œã§sassã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### autoprefixerã¨minify

æœ€å¾Œã«autoprefixerã¨minifyã‚’ã—ã¦ãŠãã¾ã™ã€‚è‡ªåˆ†ã¯ã“ã“ã§ã€Œãˆï¼Ÿã€ã¨èº“ãã¾ã—ãŸğŸ˜­

ã¨ã‚Šã‚ãˆãšå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ yarn add postcss-loader autoprefixer csswring --dev
```

ã¾ãšã¯ã€webpack.config.jsonã«postcss-loaderã‚’è¿½åŠ ã—ã¾ã™ã€‚

###### webpack.config.json
```javascript
ã€œã€œã€œçœç•¥ã€œã€œã€œ
  module: {
    rules: [
      {
        test: /\.(sass|scss)$/,
        use: [
          "style-loader",
          "css-loader",
          "postcss-loader",
          "sass-loader"
        ]
      },
    ]
  }
```

æ¬¡ã«postcss.config.jsãªã‚‹ã‚‚ã®ã‚’stylesheetsã®ä¸­ã«è¿½åŠ ã—ã¾ã™ã€‚ã‚°ã‚°ã‚‹ã¨webpack.config.jsonã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‹ã‘ã°å‹•ãã‚ˆã¨è¦‹ã‹ã‘ã¾ã™ãŒã€è‡ªåˆ†ã®ç’°å¢ƒã§ã¯å‹•ã‹ãªã‹ã£ãŸã®ã§ã™ã€‚

```
$ touch source/stylesheets/postcss.config.js
```

###### source/stylesheets/postcss.config.js
```javascript
module.exports = {
  plugins: [
    require('autoprefixer')({
      browsers: ['last 2 versions']
    }),
    require('csswring')(),
  ],
};
```

ãƒ†ã‚¹ãƒˆã§source/stylesheets/site.css.scssã«`display: flex;`ã‚’è¿½åŠ ã—ã¦ã¿ã¦ã¿ã¾ã™ã€‚

###### source/stylesheets/site.css.scss
```css
.foo {
  display: flex;
}
```

![](https://s3-ap-northeast-1.amazonaws.com/t4traw/blog/2018-02-06_14-09-00.png)

ç„¡äº‹minifyã¨ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ğŸ‘

## ğŸ‰ StaticSiteBootstrapã‚’æ›´æ–°ã—ã¦ãŠãã¾ã—ãŸã€‚

ä»Šå›ã®middleman + webpackã‚’[StaticSiteBootstrap](https://github.com/t4traw/static_site_bootstrap)ã«åæ˜ ã•ã›ã¦ãŠãã¾ã—ãŸã€‚ã¨ã„ã£ã¦ã‚‚ä»Šå›ã®å†…å®¹ãã®ã¾ã¾ã§ã™ãŒã€‚

ã“ã†ã—ã¦GitHubã«pushã—ã¦ãŠã‘ã°ã€

```
$ middleman init -T t4traw/static_site_bootstrap
```

ã‚ã¨ã¯ã„ãã¤ã‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç°¡å˜ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ç”Ÿæˆã™ã‚‹äº‹ãŒã§ãã¾ã™ã€‚ã‚ˆãé™çš„ã‚µã‚¤ãƒˆã‚’åˆ¶ä½œã™ã‚‹æ–¹ã¯ã“ã‚“ãªå…·åˆã§ã‚µã‚¯ã£ã¨ãƒ™ãƒ¼ã‚¹ã‚’ä½œã‚Œã‚‹ã¨æ¥½ã«èµ°ã‚Šå‡ºã›ã‚‹ã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ğŸƒ
